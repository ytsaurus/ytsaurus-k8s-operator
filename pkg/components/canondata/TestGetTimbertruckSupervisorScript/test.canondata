
mkdir -p /etc/timbertruck
cat <<'EOF' > /etc/timbertruck/config.yaml
json_logs:
- log_file: /yt/master-logs/master.access.log.json
  name: master-access
  yt_queue:
  - cluster: http-proxies-lb.ytsaurus-dev.svc.cluster.local
    producer_path: //sys/admin/logs/master-access/producer
    queue_path: //sys/admin/logs/master-access/queue
- log_file: /yt/master-logs/master.security.log.yson.zstd
  name: master-security
  yt_queue:
  - cluster: http-proxies-lb.ytsaurus-dev.svc.cluster.local
    producer_path: //sys/admin/logs/master-security/producer
    queue_path: //sys/admin/logs/master-security/queue
- log_file: /yt/master-logs/master.other.log.zstd
  name: master-other
  yt_queue:
  - cluster: http-proxies-lb.ytsaurus-dev.svc.cluster.local
    producer_path: //sys/admin/logs/master-other/producer
    queue_path: //sys/admin/logs/master-other/queue
work_dir: /yt/master-logs/timbertruck

EOF
chmod 644 /etc/timbertruck/config.yaml
echo "Starting timbertruck supervisor loop..."
while true; do
	/usr/bin/timbertruck_os -config /etc/timbertruck/config.yaml &
	PID=$!
	wait $PID
	echo "timbertruck process with PID $PID exited. Restarting in 10 seconds..."
	sleep 10
done
