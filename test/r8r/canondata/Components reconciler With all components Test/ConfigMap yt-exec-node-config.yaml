apiVersion: v1
data:
  ytserver-exec-node.yson: |-
    {
        "address_resolver"={
            "enable_ipv4"=%true;
            "enable_ipv6"=%false;
            retries=1000;
        };
        "solomon_exporter"={
            host="{POD_SHORT_HOSTNAME}";
            "instance_tags"={
                pod="{K8S_POD_NAME}";
            };
        };
        logging={
            writers={
                "info-stderr"={
                    type=stderr;
                    "file_name"="..";
                    "enable_compression"=%true;
                    "enable_system_messages"=%true;
                };
            };
            rules=[
                {
                    "min_level"=info;
                    writers=[
                        "info-stderr";
                    ];
                    family="plain_text";
                };
            ];
            "flush_period"=3000;
        };
        "monitoring_port"=10029;
        "rpc_port"=9029;
        "bus_server"={
            "encryption_mode"=required;
            "cert_chain"={
                "file_name"="/tls/bus_secret/tls.crt";
            };
            "private_key"={
                "file_name"="/tls/bus_secret/tls.key";
            };
            ca={
                "file_name"="/tls/ca_bundle/ca.crt";
            };
            "verification_mode"=full;
            "peer_alternative_host_name"="test-ytsaurus";
        };
        "timestamp_provider"={
            addresses=[
                "ms-0.masters.ytsaurus-components.svc.cluster.local:9010";
            ];
        };
        "cluster_connection"={
            "cluster_name"="test-ytsaurus";
            "primary_master"={
                addresses=[
                    "ms-0.masters.ytsaurus-components.svc.cluster.local:9010";
                ];
                peers=[
                    {
                        address="ms-0.masters.ytsaurus-components.svc.cluster.local:9010";
                        voting=%true;
                    };
                ];
                "cell_id"="65726e65-ad6b7562-10259-79747361";
            };
            "discovery_connection"={
                addresses=[
                    "ds-0.discovery.ytsaurus-components.svc.cluster.local:9020";
                ];
            };
            "bus_client"={
                "encryption_mode"=required;
                "cert_chain"={
                    "file_name"="/tls/bus_client_secret/tls.crt";
                };
                "private_key"={
                    "file_name"="/tls/bus_client_secret/tls.key";
                };
                ca={
                    "file_name"="/tls/ca_bundle/ca.crt";
                };
                "verification_mode"=full;
                "peer_alternative_host_name"="test-ytsaurus";
            };
            "master_cache"={
                addresses=[
                    "msc-0.master-caches.ytsaurus-components.svc.cluster.local:9018";
                ];
                "cell_id"="65726e65-ad6b7562-10259-79747361";
                "enable_master_cache_discovery"=%false;
            };
        };
        "cypress_annotations"={
            "k8s_node_name"="{K8S_NODE_NAME}";
            "k8s_pod_name"="{K8S_POD_NAME}";
            "k8s_pod_namespace"="{K8S_POD_NAMESPACE}";
            "physical_host"="{K8S_NODE_NAME}";
        };
        flavors=[
            exec;
        ];
        "resource_limits"={
            "total_memory"=10737418240;
            "total_cpu"=5.000000;
            "node_dedicated_cpu"=1.000000;
            "memory_limits"={
                "user_jobs"={
                    type=static;
                    value=8589934592;
                };
            };
        };
        "skynet_http_port"=11029;
        "job_resource_manager"={
            "resource_limits"={
                "user_slots"=20;
            };
        };
        "exec_node"={
            "slot_manager"={
                locations=[
                    {
                        path="/yt/node-data/slots";
                        "disk_quota"=5368709120;
                        "disk_usage_watermark"=536870912;
                        "enable_disk_quota"=%false;
                    };
                ];
                "job_environment"={
                    type=cri;
                    "start_uid"=19500;
                    "cri_executor"={
                        "retry_backoff_time"=1000;
                        "retry_attempts"=120;
                        "retry_timeout"=120000;
                        "runtime_endpoint"="unix:///yt/node-data/image-cache/containerd.sock";
                        "image_endpoint"="unix:///yt/node-data/image-cache/containerd.sock";
                        namespace=yt;
                        "base_cgroup"="/yt";
                    };
                    "cri_image_cache"={
                        capacity=5368709120;
                    };
                    "job_proxy_image"="docker.io/library/python:3.8-slim";
                    "job_proxy_bind_mounts"=[
                        {
                            "external_path"="/etc/ssl/certs";
                            "internal_path"="/etc/ssl/certs";
                            "read_only"=%true;
                        };
                    ];
                    "use_job_proxy_from_image"=%false;
                };
                "do_not_set_user_id"=%true;
                "enable_tmpfs"=%false;
            };
            "gpu_manager"={
                "gpu_info_source"={
                    type="nvidia_smi";
                };
            };
            "job_controller"={
                "resource_limits"={
                    "user_slots"=20;
                };
                "gpu_manager"={
                    "gpu_info_source"={
                        type="nvidia_smi";
                    };
                };
            };
            "job_proxy"={
                "job_proxy_authentication_manager"={
                    "cypress_cookie_manager"={
                    };
                    "cypress_user_manager"={
                    };
                    "cypress_token_authenticator"={
                        secure=%true;
                    };
                    "require_authentication"=%true;
                };
                "job_proxy_logging"={
                    writers={
                        info={
                            type=file;
                            "file_name"="job-proxy.info.log";
                            format="plain_text";
                            "enable_system_messages"=%true;
                        };
                        stderr={
                            type=stderr;
                            format="plain_text";
                            "enable_system_messages"=%true;
                        };
                    };
                    rules=[
                        {
                            "min_level"=info;
                            writers=[
                                info;
                            ];
                            family="plain_text";
                        };
                        {
                            "min_level"=error;
                            writers=[
                                stderr;
                            ];
                            family="plain_text";
                        };
                    ];
                    "flush_period"=3000;
                    "log_manager_template"={
                        writers={
                            info={
                                type=file;
                                "file_name"="job-proxy.info.log";
                                format="plain_text";
                                "enable_system_messages"=%true;
                            };
                            stderr={
                                type=stderr;
                                format="plain_text";
                                "enable_system_messages"=%true;
                            };
                        };
                        rules=[
                            {
                                "min_level"=info;
                                writers=[
                                    info;
                                ];
                                family="plain_text";
                            };
                            {
                                "min_level"=error;
                                writers=[
                                    stderr;
                                ];
                                family="plain_text";
                            };
                        ];
                        "flush_period"=3000;
                    };
                    mode=simple;
                };
                "environment_variables"=[
                    {
                        name="SSL_CERT_FILE";
                        value="/etc/ssl/certs/ca-certificates.crt";
                        export=%true;
                    };
                    {
                        name="SSL_CERT_DIR";
                        value="/etc/ssl/certs";
                        export=%true;
                    };
                    {
                        name="REQUESTS_CA_BUNDLE";
                        value="/etc/ssl/certs/ca-certificates.crt";
                        export=%true;
                    };
                    {
                        name="YT_SECURE_VAULT_YT_BUS_CA_BUNDLE";
                        "file_name"="/tls/ca_bundle/ca.crt";
                        export=%false;
                    };
                    {
                        name="YT_SECURE_VAULT_YT_BUS_CLIENT_CERTIFICATE";
                        "file_name"="/tls/bus_client_secret/tls.crt";
                        export=%false;
                    };
                    {
                        name="YT_SECURE_VAULT_YT_BUS_CLIENT_PRIVATE_KEY";
                        "file_name"="/tls/bus_client_secret/tls.key";
                        export=%false;
                    };
                ];
                "forward_all_environment_variables"=%true;
                "cluster_connection"={
                    "cluster_name"="test-ytsaurus";
                    "primary_master"={
                        addresses=[
                            "ms-0.masters.ytsaurus-components.svc.cluster.local:9010";
                        ];
                        peers=[
                            {
                                address="ms-0.masters.ytsaurus-components.svc.cluster.local:9010";
                                voting=%true;
                            };
                        ];
                        "cell_id"="65726e65-ad6b7562-10259-79747361";
                    };
                    "discovery_connection"={
                        addresses=[
                            "ds-0.discovery.ytsaurus-components.svc.cluster.local:9020";
                        ];
                    };
                    "bus_client"={
                        "encryption_mode"=required;
                        "cert_chain"={
                            "environment_variable"="YT_SECURE_VAULT_YT_BUS_CLIENT_CERTIFICATE";
                            "file_name"="/tls/bus_client_secret/tls.crt";
                        };
                        "private_key"={
                            "environment_variable"="YT_SECURE_VAULT_YT_BUS_CLIENT_PRIVATE_KEY";
                            "file_name"="/tls/bus_client_secret/tls.key";
                        };
                        ca={
                            "environment_variable"="YT_SECURE_VAULT_YT_BUS_CA_BUNDLE";
                            "file_name"="/tls/ca_bundle/ca.crt";
                        };
                        "verification_mode"=full;
                        "peer_alternative_host_name"="test-ytsaurus";
                    };
                    "master_cache"={
                        addresses=[
                            "msc-0.master-caches.ytsaurus-components.svc.cluster.local:9018";
                        ];
                        "cell_id"="65726e65-ad6b7562-10259-79747361";
                        "enable_master_cache_discovery"=%false;
                    };
                };
                "supervisor_connection"={
                    "encryption_mode"=required;
                    "cert_chain"={
                        "environment_variable"="YT_SECURE_VAULT_YT_BUS_CLIENT_CERTIFICATE";
                        "file_name"="/tls/bus_client_secret/tls.crt";
                    };
                    "private_key"={
                        "environment_variable"="YT_SECURE_VAULT_YT_BUS_CLIENT_PRIVATE_KEY";
                        "file_name"="/tls/bus_client_secret/tls.key";
                    };
                    ca={
                        "environment_variable"="YT_SECURE_VAULT_YT_BUS_CA_BUNDLE";
                        "file_name"="/tls/ca_bundle/ca.crt";
                    };
                    "verification_mode"=full;
                    "peer_alternative_host_name"="test-ytsaurus";
                    address="127.0.0.1:9029";
                };
            };
            "job_proxy_authentication_manager"={
                "cypress_cookie_manager"={
                };
                "cypress_user_manager"={
                };
                "cypress_token_authenticator"={
                    secure=%true;
                };
                "require_authentication"=%true;
            };
            "job_proxy_logging"={
                writers={
                    info={
                        type=file;
                        "file_name"="job-proxy.info.log";
                        format="plain_text";
                        "enable_system_messages"=%true;
                    };
                    stderr={
                        type=stderr;
                        format="plain_text";
                        "enable_system_messages"=%true;
                    };
                };
                rules=[
                    {
                        "min_level"=info;
                        writers=[
                            info;
                        ];
                        family="plain_text";
                    };
                    {
                        "min_level"=error;
                        writers=[
                            stderr;
                        ];
                        family="plain_text";
                    };
                ];
                "flush_period"=3000;
            };
            "do_not_set_user_id"=%true;
            "forward_all_environment_variables"=%true;
            "use_artifact_binds"=%true;
            "job_proxy_log_manager"={
                directory="/var/log/job-proxy";
                "sharding_key_length"=2;
                "logs_storage_period"=604800000;
                "directory_traversal_concurrency"=4;
                "log_dump"={
                    "buffer_size"=1048576;
                    "log_writer_name"=debug;
                };
            };
        };
        "data_node"={
            "store_locations"=[
            ];
            "cache_locations"=[
                {
                    path="/yt/node-data/chunk-cache";
                    quota=5368709120;
                    "io_config"={
                        "enable_sync"=%false;
                    };
                };
            ];
            "block_cache"={
                "compressed_data"={
                    capacity=0;
                };
                "uncompressed_data"={
                    capacity=0;
                };
            };
            "blocks_ext_cache"={
                capacity=0;
            };
            "chunk_meta_cache"={
                capacity=0;
            };
            "block_meta_cache"={
                capacity=0;
            };
        };
        "tablet_node"={
            "versioned_chunk_meta_cache"={
                capacity=0;
            };
        };
        "caching_object_service"={
            capacity=0;
        };
    }
kind: ConfigMap
metadata:
  annotations:
    extra-pod-annotation: "true"
    ytsaurus.tech/config-hash: e5a6e8e9a1e108e1220a02b5c0fb1272c445de86855fd723822b0fbe8c6be978
    ytsaurus.tech/config-overrides-version: "1"
    ytsaurus.tech/observed-generation: "1"
  creationTimestamp: null
  generation: 1
  labels:
    app.kubernetes.io/component: yt-exec-node
    app.kubernetes.io/managed-by: ytsaurus-k8s-operator
    app.kubernetes.io/name: yt-exec-node
    app.kubernetes.io/part-of: yt-test-ytsaurus
    yt_component: test-ytsaurus-yt-exec-node
    ytsaurus.tech/cluster-name: test-ytsaurus
  name: yt-exec-node-config
  namespace: ytsaurus-components
  ownerReferences:
  - apiVersion: cluster.ytsaurus.tech/v1
    blockOwnerDeletion: true
    controller: true
    kind: Ytsaurus
    name: test-ytsaurus
    uid: ""
  resourceVersion: "1"
